---
name: Web UI Implementation
status: open
created: 2026-02-25T02:28:43Z
updated: 2026-02-25T02:28:43Z
github: [Will be updated when synced to GitHub]
depends_on: [004, 005, 006]
parallel: true
conflicts_with: []
---

# Task: Web UI Implementation

## Description
Create a simple, functional web interface for uploading images (single and batch), viewing results with image visualization, and downloading files. Based on reference UI templates with responsive design and AJAX functionality.

## Acceptance Criteria
- [ ] HTML templates created in app/static/templates/ (index.html, batch.html)
- [ ] Single image upload interface with drag-and-drop support
- [ ] Batch upload interface with multiple file selector
- [ ] Upload progress indicators
- [ ] Result display page with image viewer (tabs for input, combined, mask, overlay)
- [ ] JSON data formatted table display
- [ ] Download buttons for images and JSON
- [ ] Defect count summary with visual indicators
- [ ] Responsive CSS styling (mobile-friendly)
- [ ] JavaScript using Fetch API for AJAX requests
- [ ] Error handling and user feedback
- [ ] UI tested in Chrome, Firefox, Edge

## Technical Details

**Directory Structure:**

```
app/static/
├── css/
│   └── style.css
├── js/
│   ├── upload.js
│   └── batch.js
└── templates/
    ├── index.html
    └── batch.html
```

**FastAPI Static Files Setup (app/main.py):**

```python
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates

app.mount("/static", StaticFiles(directory="app/static"), name="static")
templates = Jinja2Templates(directory="app/static/templates")

@app.get("/", response_class=HTMLResponse)
async def root(request: Request):
    """Serve main upload page."""
    return templates.TemplateResponse("index.html", {"request": request})

@app.get("/batch", response_class=HTMLResponse)
async def batch_page(request: Request):
    """Serve batch upload page."""
    return templates.TemplateResponse("batch.html", {"request": request})
```

**Single Upload Interface (index.html):**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AOI Inference Agent - Single Upload</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand">AOI Inference Agent</span>
            <div>
                <a href="/" class="btn btn-sm btn-outline-light">Single Upload</a>
                <a href="/batch" class="btn btn-sm btn-outline-light">Batch Upload</a>
                <a href="/docs" class="btn btn-sm btn-outline-light">API Docs</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <h2>Single Image Upload</h2>
                
                <!-- Upload Form -->
                <div class="card mt-4">
                    <div class="card-body">
                        <form id="uploadForm">
                            <div class="mb-3">
                                <label class="form-label">Select PCB Image</label>
                                <input type="file" class="form-control" id="imageInput" 
                                       accept="image/jpeg,image/png,image/tiff,image/bmp" required>
                                <div class="form-text">
                                    Supported formats: JPEG, PNG, TIFF, BMP (Max 50MB)
                                </div>
                            </div>
                            
                            <div id="dragDropArea" class="drag-drop-area mb-3">
                                <p>Or drag and drop image here</p>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" id="uploadBtn">
                                Upload & Analyze
                            </button>
                        </form>
                        
                        <div id="progressBar" class="mt-3" style="display: none;">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 100%"></div>
                            </div>
                            <p class="text-center mt-2">Processing image...</p>
                        </div>
                    </div>
                </div>

                <!-- Results Display -->
                <div id="resultsSection" class="mt-4" style="display: none;">
                    <h3>Analysis Results</h3>
                    
                    <!-- Defect Summary -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5>Defect Summary</h5>
                            <div id="defectSummary"></div>
                        </div>
                    </div>
                    
                    <!-- Image Viewer -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="imageTabs">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#inputImage">Input</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#combinedImage">Combined</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#maskImage">Mask</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#overlayImage">Overlay</a>
                                </li>
                            </ul>
                            <div class="tab-content mt-3" id="imageContent">
                                <div class="tab-pane fade show active" id="inputImage"></div>
                                <div class="tab-pane fade" id="combinedImage"></div>
                                <div class="tab-pane fade" id="maskImage"></div>
                                <div class="tab-pane fade" id="overlayImage"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Download Buttons -->
                    <div class="card">
                        <div class="card-body">
                            <h5>Downloads</h5>
                            <div id="downloadButtons"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/upload.js"></script>
</body>
</html>
```

**Upload JavaScript (upload.js):**

```javascript
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('uploadForm');
    const fileInput = document.getElementById('imageInput');
    const progressBar = document.getElementById('progressBar');
    const resultsSection = document.getElementById('resultsSection');
    const dragDropArea = document.getElementById('dragDropArea');
    
    // Drag and drop
    dragDropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dragDropArea.classList.add('drag-over');
    });
    
    dragDropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dragDropArea.classList.remove('drag-over');
        
        if (e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
        }
    });
    
    // Form submission
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const file = fileInput.files[0];
        if (!file) {
            alert('Please select an image file');
            return;
        }
        
        const formData = new FormData();
        formData.append('image', file);
        
        // Show progress
        progressBar.style.display = 'block';
        resultsSection.style.display = 'none';
        
        try {
            const response = await fetch('/api/upload', {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error('Upload failed');
            }
            
            const result = await response.json();
            displayResults(result);
            
        } catch (error) {
            alert('Error: ' + error.message);
        } finally {
            progressBar.style.display = 'none';
        }
    });
    
    function displayResults(result) {
        // Display defect summary
        const summary = document.getElementById('defectSummary');
        summary.innerHTML = `
            <p><strong>Total Defects:</strong> ${result.total_defects}</p>
            <p><strong>Processing Time:</strong> ${result.processing_time.toFixed(2)}s</p>
            <p><strong>Image ID:</strong> <code>${result.img_unique_id}</code></p>
        `;
        
        // Display images
        // Implementation for displaying images in tabs
        
        // Display download buttons
        const downloads = document.getElementById('downloadButtons');
        downloads.innerHTML = `
            <a href="${result.images.combined}" class="btn btn-sm btn-primary" download>Combined</a>
            <a href="${result.images.mask}" class="btn btn-sm btn-primary" download>Mask</a>
            <a href="${result.images.overlay}" class="btn btn-sm btn-primary" download>Overlay</a>
            <a href="/api/download/json/${result.img_unique_id}" class="btn btn-sm btn-success" download>JSON</a>
        `;
        
        resultsSection.style.display = 'block';
    }
});
```

**CSS Styling (style.css):**

```css
.drag-drop-area {
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 40px;
    text-align: center;
    background: #f9f9f9;
    cursor: pointer;
}

.drag-drop-area.drag-over {
    border-color: #007bff;
    background: #e7f3ff;
}

.tab-content img {
    max-width: 100%;
    height: auto;
}

.defect-badge {
    display: inline-block;
    padding: 5px 10px;
    margin: 5px;
    border-radius: 4px;
    background: #007bff;
    color: white;
}
```

## Dependencies
- [ ] Task 004 completed (upload endpoints)
- [ ] Task 005 completed (query endpoints)
- [ ] Task 006 completed (download endpoints)

## Effort Estimate
- Size: M
- Hours: 10-12 hours
- Parallel: true (can be developed while backend endpoints are being finalized)

## Definition of Done
- [ ] All HTML templates created and styled
- [ ] Single upload interface functional
- [ ] Batch upload interface functional
- [ ] Results display correctly
- [ ] Download buttons working
- [ ] Responsive design on mobile
- [ ] Error handling user-friendly
- [ ] Cross-browser testing completed
- [ ] UI reviewed and approved
