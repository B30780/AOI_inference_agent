---
name: Swagger UI Integration
status: open
created: 2026-02-25T02:28:43Z
updated: 2026-02-25T02:28:43Z
github: [Will be updated when synced to GitHub]
depends_on: [004, 005, 006]
parallel: false
conflicts_with: []
---

# Task: Swagger UI Integration

## Description
Configure and customize FastAPI's built-in Swagger UI documentation to provide comprehensive, interactive API documentation. Add detailed descriptions, examples, and schemas for all endpoints.

## Acceptance Criteria
- [ ] Swagger UI accessible at /docs endpoint
- [ ] All API endpoints documented with descriptions
- [ ] Request/response schemas defined and displayed
- [ ] Example payloads included for all endpoints
- [ ] Error responses documented (400, 404, 500)
- [ ] API organized with tags (Upload, Query, Download, System)
- [ ] OpenAPI 3.0 specification available at /openapi.json
- [ ] Custom title, description, and version information
- [ ] Try-it-out functionality working for all endpoints
- [ ] API documentation is clear and complete

## Technical Details

**FastAPI App Configuration (app/main.py):**

```python
from fastapi import FastAPI
from fastapi.openapi.utils import get_openapi
from app.api import upload, query, download, health

# Create FastAPI app with custom metadata
app = FastAPI(
    title="AOI Inference Agent API",
    description="""
    FastAPI-based AOI inference agent that integrates with external SegFormer 
    model service, manages image uploads, stores results in database, and 
    provides query/download capabilities.
    
    ## Features
    
    * **Upload**: Single and batch image upload for defect detection
    * **Query**: Search and retrieve historical inspection data
    * **Download**: Download images, JSON results, and batch archives
    * **Health**: System health check and statistics
    
    ## External Service
    
    This agent integrates with SegFormer service at http://140.96.77.124:8080/
    """,
    version="1.0.0",
    contact={
        "name": "AOI Team",
        "email": "aoi@example.com"
    },
    license_info={
        "name": "MIT"
    }
)

# Include routers with tags
app.include_router(
    upload.router, 
    prefix="/api",
    tags=["Upload"]
)
app.include_router(
    query.router, 
    prefix="/api",
    tags=["Query"]
)
app.include_router(
    download.router, 
    prefix="/api",
    tags=["Download"]
)
app.include_router(
    health.router, 
    prefix="/api",
    tags=["System"]
)

# Custom OpenAPI schema
def custom_openapi():
    if app.openapi_schema:
        return app.openapi_schema
        
    openapi_schema = get_openapi(
        title="AOI Inference Agent API",
        version="1.0.0",
        description="Comprehensive API for AOI defect detection",
        routes=app.routes,
    )
    
    # Add additional schema customizations
    openapi_schema["info"]["x-logo"] = {
        "url": "https://example.com/logo.png"
    }
    
    app.openapi_schema = openapi_schema
    return app.openapi_schema

app.openapi = custom_openapi
```

**Enhanced Endpoint Documentation:**

Add detailed docstrings and response models to all endpoints:

```python
@router.post(
    "/upload",
    response_model=UploadResponse,
    summary="Upload single image for defect detection",
    description="""
    Upload a single PCB image for automated optical inspection (AOI).
    
    The image will be:
    1. Validated for format and size
    2. Sent to external SegFormer service for inference
    3. Results stored in database with full defect analysis
    4. Response includes defect counts, regions, and result images
    
    **Supported formats**: JPEG, PNG, TIFF, BMP  
    **Max file size**: 50MB
    """,
    responses={
        200: {
            "description": "Image processed successfully",
            "content": {
                "application/json": {
                    "example": {
                        "success": True,
                        "img_unique_id": "20260225_103045_ABC123",
                        "processing_time": 2.34,
                        "total_defects": 7,
                        "defect_classes": {
                            "PI_Particle": 5,
                            "PR_Peeling": 1,
                            "Copper_Nodule": 1
                        }
                    }
                }
            }
        },
        400: {
            "description": "Invalid file format or size",
            "content": {
                "application/json": {
                    "example": {
                        "detail": "File size exceeds 50MB limit"
                    }
                }
            }
        },
        500: {
            "description": "Server error or external service failure",
            "content": {
                "application/json": {
                    "example": {
                        "detail": "External SegFormer service unavailable"
                    }
                }
            }
        }
    },
    tags=["Upload"]
)
async def upload_single_image(
    image: UploadFile = File(..., description="PCB image file"),
    db: Session = Depends(get_db)
):
    # Implementation
    pass
```

**Response Models with Examples:**

```python
from pydantic import BaseModel, Field
from typing import List, Dict, Optional

class UploadResponse(BaseModel):
    success: bool = Field(..., description="Upload success status")
    img_unique_id: str = Field(..., description="Unique identifier for the image")
    processing_time: float = Field(..., description="Processing time in seconds")
    total_defects: int = Field(..., description="Total number of defects detected")
    defect_classes: Dict[str, int] = Field(
        ..., 
        description="Defect counts by class"
    )
    images: Dict[str, str] = Field(
        ...,
        description="URLs to result images"
    )
    
    class Config:
        schema_extra = {
            "example": {
                "success": True,
                "img_unique_id": "20260225_103045_ABC123",
                "processing_time": 2.34,
                "total_defects": 7,
                "defect_classes": {
                    "PI_Particle": 5,
                    "PR_Peeling": 1,
                    "Copper_Nodule": 1
                },
                "images": {
                    "combined": "/api/download/image/20260225_103045_ABC123/combined",
                    "mask": "/api/download/image/20260225_103045_ABC123/mask",
                    "overlay": "/api/download/image/20260225_103045_ABC123/overlay"
                }
            }
        }
```

**Tag Descriptions:**

```python
tags_metadata = [
    {
        "name": "Upload",
        "description": "Upload images for defect detection (single or batch)",
    },
    {
        "name": "Query",
        "description": "Query and retrieve historical inspection data",
    },
    {
        "name": "Download",
        "description": "Download images, JSON results, and batch archives",
    },
    {
        "name": "System",
        "description": "System health checks and statistics",
    },
]

app = FastAPI(
    title="AOI Inference Agent API",
    description="...",
    version="1.0.0",
    openapi_tags=tags_metadata
)
```

## Dependencies
- [ ] Task 004 completed (upload endpoints)
- [ ] Task 005 completed (query endpoints)
- [ ] Task 006 completed (download endpoints)

## Effort Estimate
- Size: S
- Hours: 4-6 hours
- Parallel: false (needs all endpoints implemented first)

## Definition of Done
- [ ] Swagger UI accessible and functional at /docs
- [ ] All endpoints documented with descriptions
- [ ] Example requests/responses provided
- [ ] Error responses documented
- [ ] Tags organize endpoints logically
- [ ] Try-it-out functionality tested
- [ ] OpenAPI spec validated
- [ ] Documentation reviewed for clarity
