---
name: Project Setup and Database Foundation
status: open
created: 2026-02-25T02:28:43Z
updated: 2026-02-25T02:41:06Z
github: https://github.com/B30780/AOI_inference_agent/issues/2
depends_on: []
parallel: false
conflicts_with: []
---

# Task: Project Setup and Database Foundation

## Description
Initialize the FastAPI project structure with proper organization, configure SQLAlchemy database models for the three-table schema (images, classes, regions), set up Alembic for database migrations, create the main run.py entry point, and implement configuration management with environment variables.

## Acceptance Criteria
- [ ] FastAPI project structure created with app/ directory containing main.py, api/, models/, services/, utils/
- [ ] SQLAlchemy models implemented for Image, Class, and Region tables matching database_schema.md exactly
- [ ] Foreign key relationships configured with CASCADE delete
- [ ] Alembic initialized with initial migration script that creates all three tables
- [ ] run.py entry point created that initializes database, runs migrations, and starts Uvicorn server
- [ ] config.py implemented to load environment variables (database URL, external service URL, storage paths)
- [ ] .env.example file created with all required configuration variables
- [ ] requirements.txt populated with all dependencies (FastAPI, SQLAlchemy, Alembic, httpx, Pillow, etc.)
- [ ] Database connection pooling configured (min=5, max=20)
- [ ] Project successfully starts with `python run.py`

## Technical Details

**Directory Structure:**
```
AOI_inference_agent/
??? app/
??  ??? __init__.py
??  ??? main.py
??  ??? config.py
??  ??? api/__init__.py
??  ??? models/
??  ??  ??? __init__.py
??  ??  ??? database.py
??  ??  ??? schemas.py
??  ??? services/__init__.py
??  ??? utils/__init__.py
??? alembic/
??  ??? versions/
??? data/
??  ??? uploads/
??  ??? results/
??? run.py
??? requirements.txt
??? .env.example
```

**SQLAlchemy Models (app/models/database.py):**
- Image: All fields from database_schema.md with proper column types
- Class: Foreign key to Image, all required fields
- Region: Foreign keys to both Class and Image, all geometric properties
- Use declarative_base and proper relationships

**Configuration Variables (.env.example):**
- DATABASE_URL
- SEGFORMER_SERVICE_URL (http://140.96.77.124:8080/)
- UPLOAD_DIR
- RESULT_DIR
- LOG_LEVEL
- MAX_FILE_SIZE_MB

**run.py Implementation:**
- Load environment variables
- Initialize database connection
- Run Alembic migrations automatically
- Start Uvicorn server with proper config
- Handle startup errors gracefully

## Dependencies
- [ ] PostgreSQL database installed and accessible
- [ ] Python 3.9+ installed
- [ ] Database credentials available

## Effort Estimate
- Size: L
- Hours: 12-16 hours
- Parallel: false (foundation task - others depend on this)

## Definition of Done
- [ ] Code implemented and structured correctly
- [ ] Database schema matches specification exactly
- [ ] Alembic migration creates tables successfully
- [ ] `python run.py` starts application without errors
- [ ] Configuration loaded from .env file
- [ ] Database connection established and pooled
- [ ] Code follows PEP 8 style guidelines
- [ ] README.md includes setup instructions

